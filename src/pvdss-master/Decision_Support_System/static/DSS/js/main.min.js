var p,e,network_img_url,activities_table_header=["Activity Type","Suspect Product","Event","Description","Performed By","Timestamp"],url=$(location).attr("protocol")+"//"+$(location).attr("host");function intermediate_node_update(){for(remove_node_labels(non_terminal_nodes),j=0;j<non_terminal_nodes.length;j++){var e=node_label_dict[non_terminal_nodes[j]],t=state_dict[non_terminal_nodes[j]];e=e+"\n"+state_label_dict[t[0]]+":"+selected_record[non_terminal_nodes[j]][0];try{nodes.update({id:non_terminal_nodes[j],label:e.replace(" ","\n")})}catch(e){alert(e)}}for(j=0;j<selected_nodes.length;j++){e=node_label_dict[selected_nodes[j]],t=state_dict[selected_nodes[j]];e=e+": \n"+selected_record[selected_nodes[j]][0]+"%";try{nodes.update({id:selected_nodes[j],label:e.replace(" ","\n"),color:{background:"#ffff6e"}})}catch(e){alert(e)}}}function open_tab(e,t){var i,d,n;for(document.getElementById("details_block_1").style.display="none",document.getElementById("details_block_2").style.display="none",d=document.getElementsByClassName("tabcontent"),i=0;i<d.length;i++)d[i].style.display="none";for(n=document.getElementsByClassName("tablinks"),i=0;i<n.length;i++)n[i].className=n[i].className.replace(" active","");document.getElementById(t).style.display="block",e.currentTarget.className+=" active","activities"===t?(activities_table(),$("#activities .dataTables_scrollBody").height($(this).height()-288)):"table"==t&&(result_table(),$("#table .dataTables_scrollBody").height($(this).height()-288)),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}function open_modal_tab(e,t){for(var i,d=document.getElementsByClassName("modal_tabcontent"),n=0;n<d.length;n++)d[n].style.display="none";for(i=document.getElementsByClassName("modal_tablinks"),n=0;n<i.length;n++)i[n].className=i[n].className.replace(" active","");document.getElementById(t).style.display="block",e.currentTarget.className+=" active","review_history_tab_content"===t?display_detailed_rationale_history():"rationale_tab_content"===t&&rationale_table(),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}function update_label(){document.getElementById("product_id").innerText=selected_record.product_name,document.getElementById("event_id").innerText=selected_record.pt}function update_period(){document.getElementById("period_id").innerText=selected_period.text}function update_recommendation(){document.getElementById("recommendation_id").innerText="Confidence in Potential Signal: "+selected_record.pec_importance[0]+"%",$("#review_comment").val(comment),"yes"===confirm?($(".confirm_block input[value='yes'][type='checkbox']").prop("checked",!0),$(".confirm_block input[value='no'][type='checkbox']").prop("checked",!1)):"no"===confirm?($(".confirm_block input[value='no'][type='checkbox']").prop("checked",!0),$(".confirm_block input[value='yes'][type='checkbox']").prop("checked",!1)):($(".confirm_block input[value='yes'][type='checkbox']").prop("checked",!1),$(".confirm_block input[value='no'][type='checkbox']").prop("checked",!1))}function initialize_node_table(){for(j=0;j<selected_nodes.length;j++){var e=node_label_dict[selected_nodes[j]],t=state_dict[selected_nodes[j]],e=e+"\n"+state_label_dict[t[0]]+":"+selected_record[selected_nodes[j]][0];try{nodes.update({id:selected_nodes[j],label:e.replace(" ","\n"),color:{background:"#ffff6e"}})}catch(e){alert(e)}}remove_node_labels(manual_nodes),color_terminal_nodes(terminal_nodes),update_period(),document.getElementById("default_network").click(),redrawAll(),manual_node_form(),update_recommendation()}function redrawAll(){var e=document.getElementById("network_structure"),t={nodes:nodes,edges:edges},i={autoResize:!0,height:Math.round(.588*$(window).height())+"px",width:"100%",physics:{barnesHut:{avoidOverlap:1},repulsion:{centralGravity:.2,springLength:200,springConstant:.05,nodeDistance:500,damping:.09},solver:"barnesHut"},nodes:{shape:"dot",size:38,font:{color:"black",size:32},color:{background:"#d4e9ef",highlight:{background:"lightgrey"}}},edges:{arrows:{to:{enabled:!0,scaleFactor:.8,type:"arrow"}},length:215}},d={scale:.22},n=new vis.Network(e,t,i);n.on("zoom",function(){n.getScale()<=.22&&n.moveTo(d)}),n.on("afterDrawing",function(e){network_img_url=e.canvas.toDataURL()}),n.on("select",function(e){var t,i=e.nodes,d=nodes.get(i);0===d.length?(document.getElementById("details_block_1").style.display="none",document.getElementById("details_block_2").style.display="none"):"pec_importance"===d[0].id?($("#rationale_modal_click").click(),document.getElementById("pec_high").innerText=selected_record.pec_importance[0]+"%",document.getElementById("case_count").innerText=selected_record.new_count,document.getElementById("modal_period_label").innerText=selected_period.text,document.getElementById("default_rationale_tab").click()):($("#form_block").slideUp(),$("#form_arrow").attr("class","down_arrow_img"),t=d[0].id,document.getElementById("details_block_1").style.display="block",document.getElementById("details_block_2").style.display="block",document.getElementById("name_id").innerText=node_label_dict[t],document.getElementById("description_id").innerText=node_description_dict[t],terminal_nodes.includes(t)?(document.getElementById("value_id").style.display="inline",document.getElementById("value_label_id").style.display="inline",document.getElementById("value_id").innerText=table_label_dict[selected_record[t]]):(document.getElementById("value_id").style.display="none",document.getElementById("value_label_id").style.display="none"))}),intermediate_node_update(),update_label(),bottom_table()}function result(){var i=$("#data_table").DataTable({processing:!0,serverSide:!0,ajax:{type:"GET",url:url+"/records/?alert_id="+alert_id+"&archived="+archived+"&p="+p+"&e="+e,dataSrc:function(e){return"true"===e.login&&(window.location=e.url),e.data}},scrollX:!0,scrollY:!0,select:!0,order:[],columnDefs:[{"max-width":150,targets:"_all"}],fixedColumns:!0,oLanguage:{sProcessing:"<img height='25' width='25' src='../static/DSS/images/ajax-loader.gif'>"},createdRow:function(e,t,i){t[0]===selected_record.product_name&&t[1]===selected_record.pt&&$(e).addClass("row_selected")}});$("#data_table tbody").on("click","tr",function(t){$($("#data_table").dataTable().fnGetNodes()).removeClass("row_selected"),$(this).addClass("row_selected"),p=i.row(this).data()[0],e=i.row(this).data()[1],$("#divLoading").css("display","block"),$.ajax({type:"GET",url:url+"/selected_record/?alert_id="+alert_id+"&archived="+archived+"&p="+p+"&e="+e,dataType:"json",success:function(e){"true"===e.login&&(window.location=e.url),selected_record=e.selected_record,comment=e.comment,confirm=e.confirm,remove_node_labels(manual_nodes),color_terminal_nodes(terminal_nodes),document.getElementById("default_network").click(),redrawAll(),manual_node_form(),update_recommendation(),$("#divLoading").css("display","none")},error:function(e,t,i){alert("Error: "+i)}})})}function result_table(){$("#table").empty();var e=document.createElement("TABLE");e.setAttribute("id","data_table"),e.setAttribute("class","display dataTable");var t=e.createTHead().insertRow();for(i=0;i<result_table_header.length;i++){var d=t.insertCell(-1);d.setAttribute("align","left"),terminal_nodes.includes(result_table_header[i])?d.innerHTML=node_label_dict[result_table_header[i]]:d.innerHTML=result_table_header[i]}document.getElementById("table").appendChild(e),result()}function activities_table_body(){$("#activities_table").DataTable({processing:!0,serverSide:!0,ajax:{type:"GET",url:url+"/activities_record/?alert_id="+alert_id+"&archived="+archived+"&p="+p+"&e="+e,dataSrc:function(e){return"true"==e.login&&(window.location=e.url),e.data}},scrollX:!0,scrollY:!0,select:!0,order:[[5,"desc"]],columnDefs:[{width:150,targets:"_all"}],fixedColumns:!0,oLanguage:{sProcessing:"<img height='25' width='25' src='../static/DSS/images/ajax-loader.gif'>"}})}function activities_table(){$("#activities").empty(),$("#activities_table").length&&$("#activities_table").remove();var e=document.createElement("TABLE");e.setAttribute("id","activities_table"),e.setAttribute("class","display dataTable");var t=e.createTHead().insertRow();for(i=0;i<activities_table_header.length;i++){var d=t.insertCell(-1);d.setAttribute("align","left"),terminal_nodes.includes(activities_table_header[i])?d.innerHTML=node_label_dict[activities_table_header[i]]:d.innerHTML=activities_table_header[i]}document.getElementById("activities").appendChild(e),activities_table_body()}function bottom_table(){$("#intermediate_scores").show(),$("#score_table_div").show(),$("#score_table_div").empty();var e=document.createElement("TABLE");e.setAttribute("id","score_table"),e.setAttribute("class","score_table display dataTable"),jQuery(document).ready(function(){$(e).DataTable({scrollX:!0,paging:!1,searching:!1,info:!1,ordering:!1})});var t,d=e.createTHead().insertRow();for(i=0;i<non_terminal_nodes.length;i++){(t=d.insertCell(-1)).setAttribute("align","left"),t.innerHTML=node_label_dict[non_terminal_nodes[i]]}for(body=e.createTBody(),(d=body.insertRow()).setAttribute("class","score_table"),node_index=0;node_index<non_terminal_nodes.length;node_index++){(t=d.insertCell(-1)).setAttribute("align","left");var n="";for(i=0;i<json_records_keys.length;i++)if(json_records_keys[i]===non_terminal_nodes[node_index]){var r=state_dict[non_terminal_nodes[node_index]];for(state_index=0;state_index<r.length;state_index++)n=n+table_label_dict[r[state_index]]+": "+selected_record[json_records_keys[i]][state_index]+"<br>"}t.innerHTML=n}document.getElementById("score_table_div").appendChild(e)}function manual_node_form(){$("#manual_node_table").length&&$("#manual_node_table").remove();var e=document.createElement("tbody");e.setAttribute("id","manual_node_table");var t="",i="",d="",n="",r="";for(index=0;index<manual_nodes.length;index++)d=document.createElement("tr"),t=document.createElement("td"),(i=document.createElement("label")).innerHTML=node_label_dict[manual_nodes[index]],t.appendChild(i),d.appendChild(t),t=document.createElement("td"),div=document.createElement("div"),div.setAttribute("class","checkbox-custom"),i=document.createElement("label"),(n=document.createElement("input")).setAttribute("type","checkbox"),n.setAttribute("class","form-check-input"),n.setAttribute("value",state_dict[manual_nodes[index]][0]),terminal_nodes.includes(manual_nodes[index])&&selected_record[manual_nodes[index]]===state_dict[manual_nodes[index]][0]&&n.setAttribute("checked","true"),n.setAttribute("name",manual_nodes[index]),n.setAttribute("style","cursor:pointer"),div.appendChild(n),r=document.createTextNode(table_label_dict[state_dict[manual_nodes[index]][0]]),i.appendChild(r),div.appendChild(i),t.appendChild(div),d.appendChild(t),t=document.createElement("td"),div=document.createElement("div"),div.setAttribute("class","checkbox-custom"),i=document.createElement("label"),(n=document.createElement("input")).setAttribute("type","checkbox"),n.setAttribute("class","form-check-input"),n.setAttribute("value",state_dict[manual_nodes[index]][1]),terminal_nodes.includes(manual_nodes[index])&&selected_record[manual_nodes[index]]===state_dict[manual_nodes[index]][1]&&n.setAttribute("checked","true"),n.setAttribute("name",manual_nodes[index]),n.setAttribute("style","cursor:pointer"),div.appendChild(n),r=document.createTextNode(table_label_dict[state_dict[manual_nodes[index]][1]]),i.appendChild(r),div.appendChild(i),t.appendChild(div),d.appendChild(t),e.appendChild(d);document.getElementById("form_table").appendChild(e),$("input:checkbox").on("click",function(){var e,t=$(this);t.is(":checked")?(e="input:checkbox[name='"+t.attr("name")+"']",$(e).prop("checked",!1),t.prop("checked",!0)):t.prop("checked",!1)})}function getFormData(e){var t=e.serializeArray(),i={};return $.map(t,function(e,t){i[e.name]=e.value}),i}function remove_node_labels(e){for(i=0;i<e.length;i++)try{nodes.update({id:e[i],label:node_label_dict[e[i]].replace(" ","\n"),color:{background:"#d4e9ef"}})}catch(e){alert(e)}}function color_terminal_nodes(e){for(var t=0;t<e.length;t++)if("yes"===selected_record[e[t]].toLowerCase()&&"direct"===node_effect[e[t]]||"no"===selected_record[e[t]].toLowerCase()&&"inverse"===node_effect[e[t]])try{nodes.update({id:e[t],label:node_label_dict[e[t]].replace(" ","\n")+"\n"+state_label_dict[selected_record[e[t]]],color:{background:"#ff9a98"}})}catch(e){alert(e)}else try{nodes.update({id:e[t],label:node_label_dict[e[t]].replace(" ","\n")+"\n"+state_label_dict[selected_record[e[t]]],color:{background:"#90ee90"}})}catch(e){alert(e)}}function review_storage(){comment=$("#review_comment").val(),e=selected_record.pt,p=selected_record.product_name,confirm=$("input[name='confirm']:checked").val(),void 0===confirm&&(confirm=""),$.ajax({type:"POST",url:"/dss_review/",data:JSON.stringify({comment:comment,confirm:confirm,alert_id:alert_id,archived:archived.toString(),p:p,e:e,common_name:common_name}),success:function(e){"true"===e.login&&(window.location=e.url),activities_table()},error:function(e,t,i){alert("Error: "+i)}})}function format_rationale_table_child(e){var t=$();for(child_node_index=0;child_node_index<e.length;child_node_index++)t=t.add("<tr><td></td><td>"+rationale_table_child_dict[e[child_node_index]][0]+'</td><td class ="text-center"><span class =" badge badge-'+rationale_table_child_dict[e[child_node_index]][1]+'">'+rationale_table_child_dict[e[child_node_index]][1]+'</span></td><td class ="text-center">'+rationale_table_child_dict[e[child_node_index]][2]+"</td><td>"+rationale_table_child_dict[e[child_node_index]][3]+"</td></tr>");return t}function rationale_table(){var e=document.createElement("TABLE");e.setAttribute("id","rationale_table_dt"),e.setAttribute("class","display dataTable"),jQuery(document).ready(function(){var i=$(e).DataTable({scrollX:!1,paging:!1,searching:!1,info:!1,order:[[2,"desc"]],autoWidth:!1,columnDefs:[{orderable:!1,width:1,targets:0}]});$("#rationale_table_dt").on("click","td.details-control",function(){var e=$(this).closest("tr"),t=i.row(e);t.child.isShown()?(t.child.hide(),e.removeClass("shown")):(t.child(format_rationale_table_child(e.data("key-child").split(","))).show(),e.addClass("shown"))}),$("#ExpandCollapseAll").click(function(){this.classList.contains("double_down")?(this.classList.remove("double_down"),this.classList.add("double_up"),i.rows().every(function(e){this.child.isShown()||(tr=this.node(),tr.hasAttribute("data-key-child")&&(this.child(format_rationale_table_child(tr.getAttribute("data-key-child").split(","))).show(),$(this.node()).addClass("shown")))})):this.classList.contains("double_up")?(this.classList.remove("double_up"),this.classList.add("double_down"),i.rows().every(function(){this.child.isShown()&&(this.child.hide(),$(this.node()).removeClass("shown"))})):(console.log("class else down present"),this.classList.remove("double_down"),this.classList.add("double_up"),i.rows(":not(.parent)").nodes().to$().find("td:first-child").trigger("click"))})});var t=e.createTHead().insertRow();t.setAttribute("class","modal_dataTable_Header");var d=t.insertCell(-1);d.setAttribute("align","left"),d.setAttribute("id","ExpandCollapseAll"),d.setAttribute("class","double_down"),d.innerHTML="",(d=t.insertCell(-1)).setAttribute("align","left"),d.innerHTML="PV Concept",(d=t.insertCell(-1)).setAttribute("align","center"),d.innerHTML="Potential Signal",(d=t.insertCell(-1)).setAttribute("align","center"),d.innerHTML="Score Confidence",(d=t.insertCell(-1)).setAttribute("align","left"),d.setAttribute("class","col-min-100 col-max-300 cell-break"),d.innerHTML="Rationale",body=e.createTBody();var n=Object.keys(rationale_order_dict);for(i=0;i<n.length;i++)if(""===rationale_parent_dict[n[i]])if(t=body.insertRow(),child_nodes=[],child_nodes=Object.keys(rationale_parent_dict).filter(function(e){return rationale_parent_dict[e]===n[i]}),(d=t.insertCell(-1)).setAttribute("align","left"),d.innerHTML="",0<child_nodes.length&&(d.setAttribute("class","details-control"),t.setAttribute("data-key-child",child_nodes)),(d=t.insertCell(-1)).setAttribute("align","left"),d.innerHTML=node_label_dict[n[i]],(d=t.insertCell(-1)).setAttribute("align","center"),"object"!=typeof selected_record[n[i]]&&null!=selected_record[n[i]]?"yes"===selected_record[n[i]].toLowerCase()&&"direct"===node_effect[n[i]]||"no"===selected_record[n[i]].toLowerCase()&&"inverse"===node_effect[n[i]]?d.innerHTML='<span class ="badge badge-Yes">Yes</span>':d.innerHTML='<span class ="badge badge-No">No</span>':"object"==typeof selected_record[n[i]]?selected_record[n[i]][0]>rationale_threshold_dict[n[i]]&&"direct"===node_effect[n[i]]||selected_record[n[i]][0]<rationale_threshold_dict[n[i]]&&"inverse"===node_effect[n[i]]?d.innerHTML='<span class ="badge badge-Yes">Yes</span>':d.innerHTML='<span class ="badge badge-No">No</span>':d.innerHTML="",(d=t.insertCell(-1)).setAttribute("align","center"),"object"==typeof selected_record[n[i]]?selected_record[n[i]][0]>rationale_threshold_dict[n[i]]&&"direct"===node_effect[n[i]]||selected_record[n[i]][0]>rationale_threshold_dict[n[i]]&&"inverse"===node_effect[n[i]]?d.innerHTML=selected_record[n[i]][0]+"%":d.innerHTML=selected_record[n[i]][1]+"%":d.innerHTML="",(d=t.insertCell(-1)).setAttribute("align","left"),"object"!=typeof selected_record[n[i]]&&null!=selected_record[n[i]])if("yes"===selected_record[n[i]].toLowerCase()&&"direct"===node_effect[n[i]]||"no"===selected_record[n[i]].toLowerCase()&&"inverse"===node_effect[n[i]]){if(temp_str=rationale_text_potential_yes[n[i]].replace(/\n/g," <br>"),matched_strings=temp_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),temp_str=temp_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);if("severity_incr"===n[i]){for(boolean_params="New seriousness type observed: <br>",percent_params="Increase in existing seriousness: <br>",ind=0;ind<boolean_severity.length;ind++)1===parseInt(selected_record[boolean_severity[ind]])&&(boolean_params=boolean_params+severity_rationale_dict[boolean_severity[ind]]+", ");for("New seriousness type observed: <br>"!==boolean_params&&(temp_str=temp_str+"<br>"+boolean_params.slice(0,-2)),ind=0;ind<percent_severity.length;ind++)if(parseFloat(selected_record[percent_severity[ind]])>parseFloat(severity_incr_threshold)){if(regex_str=severity_rationale_dict[percent_severity[ind]].replace(/\n/g," <br>"),matched_strings=regex_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),regex_str=regex_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);percent_params=percent_params+regex_str+", "}"Increase in existing seriousness: <br>"!==percent_params&&(temp_str=temp_str+"<br>"+percent_params.slice(0,-2))}d.innerHTML=temp_str}else{if(temp_str=rationale_text_potential_no[n[i]].replace(/\n/g," <br>"),matched_strings=temp_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),temp_str=temp_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);d.innerHTML=temp_str}else if("object"==typeof selected_record[n[i]])if(selected_record[n[i]][0]>rationale_threshold_dict[n[i]]&&"direct"===node_effect[n[i]]||selected_record[n[i]][0]<rationale_threshold_dict[n[i]]&&"inverse"===node_effect[n[i]]){if(temp_str=rationale_text_potential_yes[n[i]].replace(/\n/g," <br>"),matched_strings=temp_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),temp_str=temp_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);d.innerHTML=temp_str}else{if(temp_str=rationale_text_potential_no[n[i]].replace(/\n/g," <br>"),matched_strings=temp_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),temp_str=temp_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);d.innerHTML=temp_str}else d.innerHTML="";else if(rationale_table_child_dict[n[i]]=[],rationale_table_child_dict[n[i]].push(node_label_dict[n[i]]),"object"!=typeof selected_record[n[i]]&&null!=selected_record[n[i]]?"yes"===selected_record[n[i]].toLowerCase()&&"direct"===node_effect[n[i]]||"no"===selected_record[n[i]].toLowerCase()&&"inverse"===node_effect[n[i]]?rationale_table_child_dict[n[i]].push("Yes"):rationale_table_child_dict[n[i]].push("No"):"object"==typeof selected_record[n[i]]?selected_record[n[i]][0]>rationale_threshold_dict[n[i]]&&"direct"===node_effect[n[i]]||selected_record[n[i]][0]<rationale_threshold_dict[n[i]]&&"inverse"===node_effect[n[i]]?rationale_table_child_dict[n[i]].push("Yes"):rationale_table_child_dict[n[i]].push("No"):rationale_table_child_dict[n[i]].push(" "),"object"==typeof selected_record[n[i]]?selected_record[n[i]][0]>rationale_threshold_dict[n[i]]&&"direct"===node_effect[n[i]]||selected_record[n[i]][0]>rationale_threshold_dict[n[i]]&&"inverse"===node_effect[n[i]]?rationale_table_child_dict[n[i]].push(selected_record[n[i]][0]+"%"):rationale_table_child_dict[n[i]].push(selected_record[n[i]][1]+"%"):rationale_table_child_dict[n[i]].push(" "),"object"!=typeof selected_record[n[i]]&&null!=selected_record[n[i]])if("yes"===selected_record[n[i]].toLowerCase()&&"direct"===node_effect[n[i]]||"no"===selected_record[n[i]].toLowerCase()&&"inverse"===node_effect[n[i]]){if(temp_str=rationale_text_potential_yes[n[i]].replace(/\n/g," to<br>"),matched_strings=temp_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),temp_str=temp_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);rationale_table_child_dict[n[i]].push(temp_str)}else{if(temp_str=rationale_text_potential_no[n[i]].replace(/\n/g," to<br>"),matched_strings=temp_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),temp_str=temp_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);rationale_table_child_dict[n[i]].push(temp_str)}else if("object"==typeof selected_record[n[i]])if(selected_record[n[i]][0]>rationale_threshold_dict[n[i]]&&"direct"===node_effect[n[i]]||selected_record[n[i]][0]<rationale_threshold_dict[n[i]]&&"inverse"===node_effect[n[i]]){if(temp_str=rationale_text_potential_yes[n[i]].replace(/\n/g," to<br>"),matched_strings=temp_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),temp_str=temp_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);rationale_table_child_dict[n[i]].push(temp_str)}else{if(temp_str=rationale_text_potential_no[n[i]].replace(/\n/g," to<br>"),matched_strings=temp_str.match(/=[a-zA-Z0-9_]+/g),null!=matched_strings)for(matched_index=0;matched_index<matched_strings.length;matched_index++)"New"===selected_record[matched_strings[matched_index].replace("=","")]&&(temp_str=temp_str.replace(new RegExp(",.*"+matched_strings[matched_index],"g"),"")),temp_str=temp_str.replace(matched_strings[matched_index],selected_record[matched_strings[matched_index].replace("=","")]);rationale_table_child_dict[n[i]].push(temp_str)}else rationale_table_child_dict[n[i]].push(" ");$("#rationale_tab_content").empty(),document.getElementById("rationale_tab_content").appendChild(e)}function display_detailed_rationale_history(){$.ajax({type:"POST",url:url+"/detailed_history/",data:JSON.stringify({p:p,e:e,alert_id:alert_id,archived:archived.toString()}),success:function(e){"true"===e.login&&(window.location=e.url),create_rationale_history_table(e.data)},error:function(e,t,i){alert("Error: "+i)}})}function format_detailed_history_table_child(e){var t=$();for(child_node_index=0;child_node_index<e.length;child_node_index++){for(element="<tr><td></td><td>"+detailed_history_table_child_dict[e[child_node_index]][0]+"</td>",index=1;index<detailed_history_table_child_dict[e[child_node_index]].length;index++)element=element+'<td class ="text-center"><span class = "badge badge-'+detailed_history_table_child_dict[e[child_node_index]][index]+'">'+detailed_history_table_child_dict[e[child_node_index]][index]+"</span></td>";element+="</tr>",t=t.add(element)}return t}function create_rationale_history_table(e){var t=document.createElement("TABLE");t.setAttribute("id","rationale_history"),t.setAttribute("class","display dataTable"),jQuery(document).ready(function(){var i=$(t).DataTable({scrollX:!1,paging:!1,searching:!1,info:!1,order:[],autoWidth:!1,columnDefs:[{orderable:!1,width:1,targets:0}]});$("#rationale_history").on("click","td.details-control",function(){var e=$(this).closest("tr"),t=i.row(e);t.child.isShown()?(t.child.hide(),e.removeClass("shown")):(t.child(format_detailed_history_table_child(e.data("key-child").split(","))).show(),e.addClass("shown"))}),$("#history_ExpandCollapseAll").click(function(){this.classList.contains("double_down")?(this.classList.remove("double_down"),this.classList.add("double_up"),i.rows().every(function(e){this.child.isShown()||(tr=this.node(),tr.hasAttribute("data-key-child")&&(this.child(format_detailed_history_table_child(tr.getAttribute("data-key-child").split(","))).show(),$(this.node()).addClass("shown")))})):this.classList.contains("double_up")?(this.classList.remove("double_up"),this.classList.add("double_down"),i.rows().every(function(){this.child.isShown()&&(this.child.hide(),$(this.node()).removeClass("shown"))})):(console.log("class else down present"),this.classList.remove("double_down"),this.classList.add("double_up"),i.rows(":not(.parent)").nodes().to$().find("td:first-child").trigger("click"))})});var d=t.createTHead().insertRow();d.setAttribute("class","modal_dataTable_Header");var n=d.insertCell(-1);for(n.setAttribute("align","left"),n.setAttribute("id","history_ExpandCollapseAll"),n.setAttribute("class","double_down"),n.innerHTML="",(n=d.insertCell(-1)).setAttribute("align","left"),n.innerHTML="PV Concept",period_score_dict_keys=Object.keys(e),i=0;i<period_score_dict_keys.length;i++){(n=d.insertCell(-1)).setAttribute("align","center"),n.innerHTML=period_score_dict_keys[i].replace(" - "," to<br>")}body=t.createTBody();var r=Object.keys(rationale_order_dict);for(row_count=0,i=0;i<r.length;i++)if(""===rationale_parent_dict[r[i]])for(row_count+=1,d=body.insertRow(),child_nodes=[],child_nodes=Object.keys(rationale_parent_dict).filter(function(e){return rationale_parent_dict[e]===r[i]}),(n=d.insertCell(-1)).setAttribute("align","left"),n.innerHTML="",0<child_nodes.length&&(n.setAttribute("class","details-control"),d.setAttribute("data-key-child",child_nodes)),(n=d.insertCell(-1)).setAttribute("align","left"),n.innerHTML=node_label_dict[r[i]],period_index=0;period_index<period_score_dict_keys.length;period_index++)(n=d.insertCell(-1)).setAttribute("align","center"),"object"!=typeof e[period_score_dict_keys[period_index]][r[i]]&&null!=e[period_score_dict_keys[period_index]][r[i]]?"yes"===e[period_score_dict_keys[period_index]][r[i]].toLowerCase()&&"direct"===node_effect[r[i]]||"no"===e[period_score_dict_keys[period_index]][r[i]].toLowerCase()&&"inverse"===node_effect[r[i]]?n.innerHTML='<span class ="badge badge-Yes">Yes</span>':n.innerHTML='<span class ="badge badge-No">No</span>':"object"==typeof e[period_score_dict_keys[period_index]][r[i]]?e[period_score_dict_keys[period_index]][r[i]][0]>rationale_threshold_dict[r[i]]&&"direct"===node_effect[r[i]]||e[period_score_dict_keys[period_index]][r[i]][0]<rationale_threshold_dict[r[i]]&&"inverse"===node_effect[r[i]]?n.innerHTML='<span class ="badge badge-Yes">Yes</span>':n.innerHTML='<span class ="badge badge-No">No</span>':n.innerHTML="";else for(detailed_history_table_child_dict[r[i]]=[],detailed_history_table_child_dict[r[i]].push(node_label_dict[r[i]]),period_index=0;period_index<period_score_dict_keys.length;period_index++)"object"!=typeof e[period_score_dict_keys[period_index]][r[i]]&&null!=e[period_score_dict_keys[period_index]][r[i]]?"yes"===e[period_score_dict_keys[period_index]][r[i]].toLowerCase()&&"direct"===node_effect[r[i]]||"no"===e[period_score_dict_keys[period_index]][r[i]].toLowerCase()&&"inverse"===node_effect[r[i]]?detailed_history_table_child_dict[r[i]].push("Yes"):detailed_history_table_child_dict[r[i]].push("No"):"object"==typeof e[period_score_dict_keys[period_index]][r[i]]?e[period_score_dict_keys[period_index]][r[i]][0]>rationale_threshold_dict[r[i]]&&"direct"===node_effect[r[i]]||e[period_score_dict_keys[period_index]][r[i]][0]<rationale_threshold_dict[r[i]]&&"inverse"===node_effect[r[i]]?detailed_history_table_child_dict[r[i]].push("Yes"):detailed_history_table_child_dict[r[i]].push("No"):detailed_history_table_child_dict[r[i]].push(" ");for(footer=t.createTFoot(),d=footer.insertRow(),row_count%2==0?d.setAttribute("class","odd"):d.setAttribute("class","even"),(n=d.insertCell(-1)).setAttribute("align","left"),n.innerHTML="",(n=d.insertCell(-1)).setAttribute("align","left"),n.innerHTML="DSS Score (Confidene in <br>Potential signal)",period_index=0;period_index<period_score_dict_keys.length;period_index++)(n=d.insertCell(-1)).setAttribute("align","center"),n.innerHTML="<b>"+e[period_score_dict_keys[period_index]].pec_importance[0]+"%</b>",parseFloat(e[period_score_dict_keys[period_index]].pec_importance[0])>dss_threshold_dict.red?n.style.color="#efa376":parseFloat(e[period_score_dict_keys[period_index]].pec_importance[0])>dss_threshold_dict.yellow?n.style.color="#ffd300":n.style.color="#70c1b3";$("#review_history_tab_content").empty(),document.getElementById("review_history_tab_content").appendChild(t)}rationale_table_child_dict={},detailed_history_table_child_dict={},$(document).ready(function(){$("#alert_period").on("select2:select",function(e){alert_id=$("#alert_period").select2("data")[0].id,archived=$("#alert_period").select2("data")[0].title,selected_period=$("#alert_period").select2("data")[0],p=selected_record.product_name,e=selected_record.pt,$("#divLoading").css("display","block"),$.ajax({type:"GET",url:url+"/record/?alert_id="+alert_id+"&archived="+archived+"&p="+p+"&e="+e,dataType:"json",success:function(e){var t,i;"true"===e.login&&(window.location=e.url),selected_record=e.selected_record,comment=e.comment,confirm=e.confirm,"object"==typeof selected_record?initialize_node_table():(result_table(),update_period(),$("#network_structure").empty(),(t=document.createElement("p")).setAttribute("id","error_text"),i=document.createTextNode("No record found. Please select a record from Result table tab."),t.appendChild(i),document.getElementById("network_structure").appendChild(t),$("#intermediate_scores").hide(),$("#score_table_div").hide(),document.getElementById("product_id").innerText="No record",document.getElementById("event_id").innerText="No record")},error:function(e,t,i){alert("Error: "+i)},complete:function(){$("#divLoading").css("display","none")}})})}),$(document).ready(function(){p=selected_record.product_name,e=selected_record.pt,$("#alert_period").select2({width:"100%",placeholder:"--Select Period--",ajax:{type:"GET",url:url+"/period/",data:function(t){return{alert_id:alert_id,archived:archived,p:p,e:e,q:t.term}},dataType:"json",success:function(e){"true"===e.login&&(window.location=e.url)}}})}),$(document).ready(function(){$("#manual_node_form").submit(function(t){t.preventDefault();var i=$(this);form_url=i.attr("action"),data=getFormData(i),data.p=p,data.e=e,data.alert_id=alert_id,data.archived=archived.toString(),data.record=JSON.stringify(selected_record),$.ajax({type:"POST",url:form_url,data:JSON.stringify(data),success:function(e){"true"===e.login&&(window.location=e.url),selected_record=e.selected_record,form_submitted_node=e.form_submitted_node,remove_node_labels(manual_nodes),color_terminal_nodes(form_submitted_node),redrawAll()},error:function(e,t,i){alert("Error: "+i)}})})}),$(document).ready(function(){document.getElementById("form_clickable").addEventListener("click",function(){"none"===document.getElementById("form_block").style.display?($("#form_arrow").attr("class","up_arrow_img"),document.getElementById("details_block_1").style.display="none",document.getElementById("details_block_2").style.display="none"):$("#form_arrow").attr("class","down_arrow_img");$("#form_block").slideToggle()})}),$(document).ready(function(){document.getElementById("query_variables_clickable").addEventListener("click",function(){"none"===document.getElementById("query_variables_block").style.display?$("#query_variables_arrow").attr("class","up_arrow_img"):$("#query_variables_arrow").attr("class","down_arrow_img");$("#query_variables_block").slideToggle()})}),$(document).ready(function(){$("#export_button").click(function(){var e=document.createElement("div"),t=document.createElement("img");t.setAttribute("height","720px"),t.setAttribute("width","1000px"),t.src=network_img_url;var d=document.getElementById("product_id").cloneNode(!0),n=document.getElementById("event_id").cloneNode(!0),r=document.getElementById("period_id").cloneNode(!0),a=document.getElementById("network_legend").cloneNode(!0);a.setAttribute("style","padding-left:520px"),t.setAttribute("style","padding-right:250px"),e.appendChild(d),e.appendChild(document.createElement("br")),e.appendChild(n),e.appendChild(document.createElement("br")),e.appendChild(r),e.appendChild(document.createElement("br")),e.appendChild(a),e.appendChild(document.createElement("br")),e.appendChild(t);var o=document.createElement("TABLE");for(o.setAttribute("style","border: 1px solid #bebebe !important"),body=o.createTBody(),node_index=0;node_index<non_terminal_nodes.length;node_index++){var l=body.insertRow();l.setAttribute("style","border: 1px solid #bebebe !important");var c=l.insertCell(-1);c.innerHTML=node_label_dict[non_terminal_nodes[node_index]]+" :",c=l.insertCell(-1);var s="";for(i=0;i<json_records_keys.length;i++)if(json_records_keys[i]===non_terminal_nodes[node_index]){var _=state_dict[non_terminal_nodes[node_index]];for(state_index=0;state_index<_.length;state_index++)s=s+table_label_dict[_[state_index]]+": "+selected_record[json_records_keys[i]][state_index]+"<br>"}c.innerHTML=s}var m=document.createElement("div"),p=document.createElement("label");p.style.fontSize="14px",p.innerHTML="Intermediate Scores : ",m.appendChild(p),m.appendChild(document.createElement("br")),m.appendChild(o);var h={margin:[28,15,15,15],filename:d.innerHTML+"_"+n.innerHTML+"_"+r.innerHTML+".pdf",image:{type:"jpeg",quality:1},pagebreak:{mode:["css","whiteline"],avoid:["img",".row"]},html2canvas:{scale:4,dpi:300,letterRendering:!0,logging:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}},u=new Image;u.src="../static/DSS/images/company-logo.png",html2pdf().from(e).set(h).toPdf().get("pdf").then(function(e){e.addPage()}).from(m).toContainer().toCanvas().toPdf().get("pdf").then(function(e){var t=e.internal.getNumberOfPages();for(i=1;i<=t;i++)e.setPage(i),e.setFontSize(14),e.setFontType("bold"),e.addImage(u,"PNG",15,5,20,10),e.text("Decision Support System",80,24),e.setLineCap(2),e.setLineWidth(.5),e.line(15,25,e.internal.pageSize.getWidth()-15,25),e.setFontType("normal"),e.setFontSize(9),e.text(i+" of "+t,15,e.internal.pageSize.getHeight()-10),e.text("RxLogix Corporation India  All Rights Reserved © 2020",e.internal.pageSize.getWidth()-100,e.internal.pageSize.getHeight()-10)}).save()})}),$(document).ready(function(){$(".confirm_block input[value='yes'][type='checkbox']").change(function(){$(".confirm_block input[value='yes'][type='checkbox']").prop("checked",$(this).prop("checked"))}),$(".confirm_block input[value='no'][type='checkbox']").change(function(){$(".confirm_block input[value='no'][type='checkbox']").prop("checked",$(this).prop("checked"))})});